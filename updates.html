<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Updates - Tech Updates</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .updates-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .unread-badge {
            background-color: #e74c3c;
            color: white;
            border-radius: 20px;
            padding: 5px 12px;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .scroll-to-bottom-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background-color: var(--primary-blue);
            color: var(--white);
            padding: 10px 20px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 500;
            transition: background-color 0.2s;
            border: none;
            cursor: pointer;
        }

        .scroll-to-bottom-btn:hover {
            background-color: var(--dark-blue);
        }

        .update {
            padding: 20px;
            border-bottom: 1px solid var(--medium-gray);
            position: relative;
            transition: all 0.3s ease;
        }

        .update:last-child {
            border-bottom: none;
        }

        .update.unread {
            background-color: rgba(231, 243, 255, 0.5);
            border-left: 4px solid var(--primary-blue);
        }

        .update.deleted {
            display: none;
        }

        .update-content {
            margin-bottom: 15px;
        }

        .update-text {
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .update-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .update-reactions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .update-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .view-whatsapp-btn {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            color: var(--primary-blue);
            text-decoration: none;
            font-weight: 500;
            font-size: 14px;
        }

        .delete-update-btn {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            color: #e74c3c;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .delete-update-btn:hover {
            background-color: rgba(231, 76, 60, 0.1);
        }

        .notification-banner {
            background-color: #e7f3ff;
            border: 1px solid var(--primary-blue);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .notification-banner i {
            color: var(--primary-blue);
            font-size: 18px;
        }

        .empty-updates {
            text-align: center;
            padding: 40px 20px;
            color: var(--dark-gray);
        }

        .empty-updates i {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--medium-gray);
        }

        @media (max-width: 768px) {
            .updates-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .update-meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .update-actions {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <header>
        <div id="logo">TECH <span>UPDATES</span></div>
        <button>‚ò∞</button>
        <div id="menu" hidden>
            <a href="index.html"><i class="fas fa-home"></i> Home</a>
            <a href="updates.html" class="active"><i class="fas fa-bell"></i> Updates</a>
            <a href="projects.html"><i class="fas fa-project-diagram"></i> Projects</a>
            <a href="notes.html"><i class="fas fa-sticky-note"></i> Notes</a>
            <a href="dashboard.html"><i class="fas fa-chart-bar"></i> Dashboard</a>
            <a href="workspace.html"><i class="fas fa-desktop"></i> Workspace</a>
            <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </div>
    </header>

    <div id="info">
        <div class="updates-header">
            <div>
                <h1 class="page-title">Channel Updates</h1>
                <p class="page-description">Latest announcements from our WhatsApp channel</p>
            </div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <div id="unreadBadge" class="unread-badge" style="display: none;">
                    <i class="fas fa-circle"></i> <span id="unreadCount">0</span> unread
                </div>
                <button class="scroll-to-bottom-btn" id="scrollToBottom">
                    <i class="fas fa-arrow-down"></i> Latest
                </button>
            </div>
        </div>

        <!-- Notification Banner -->
        <div class="notification-banner" id="notificationBanner" style="display: none;">
            <i class="fas fa-bell"></i>
            <div>
                <strong>New updates available!</strong> Scroll down to see the latest announcements.
            </div>
        </div>

        <div class="content-section" id="updatesContainer">
            <!-- Updates will be loaded here dynamically -->
        </div>

        <!-- Empty State -->
        <div class="empty-updates" id="emptyUpdates" style="display: none;">
            <i class="fas fa-bell-slash"></i>
            <h3>No Updates Available</h3>
            <p>All updates have been deleted or there are no new announcements.</p>
        </div>
    </div>

    <footer>
        &copy; 2025 Tech Updates. All rights reserved
    </footer>

    <script>
        // Updates Management System
        const UpdatesManager = {
            // Initialize updates system
            init: function() {
                this.checkAuth();
                this.loadUpdates();
                this.setupEventListeners();
                this.setupScrollObserver();
                this.checkForNewUpdates();
            },

            // Check authentication
            checkAuth: function() {
                const user = localStorage.getItem('techUpdatesUser');
                if (!user) {
                    window.location.href = 'login.html';
                    return;
                }
            },

            // Sample updates data
            getDefaultUpdates: function() {
                return [
                    {
                        id: 1,
                        content: "We're gonna build a telegram bot, let's name it SOS BOT 7",
                        reactions: { comments: 3 },
                        isRead: false
                    },
                    {
                        id: 2,
                        content: "First Come, first served<br>Bot, then AI",
                        reactions: { comments: 7, likes: 12 },
                        isRead: false
                    },
                    {
                        id: 3,
                        content: "Telegram/Discord AI Bot - Integrate OpenAI to answer questions, summarize links, or moderate chats.<br><br>Real-Time Collaborative Todo App - Like Notion, but simpler. Use Supabase or Firebase for live updates.<br><br>* 100 Habit Tracking ... Read more",
                        reactions: { comments: 5 },
                        isRead: false
                    },
                    {
                        id: 4,
                        content: "Someone reacted with üí¨ to an update",
                        reactions: { comments: 1 },
                        isRead: false
                    },
                    {
                        id: 5,
                        content: "on user behavior.",
                        reactions: { comments: 2, likes: 8 },
                        isRead: false
                    }
                ];
            },

            // Get updates from localStorage
            getUpdates: function() {
                const updates = localStorage.getItem('techUpdates');
                if (!updates) {
                    const defaultUpdates = this.getDefaultUpdates();
                    this.saveUpdates(defaultUpdates);
                    return defaultUpdates;
                }
                return JSON.parse(updates);
            },

            // Save updates to localStorage
            saveUpdates: function(updates) {
                localStorage.setItem('techUpdates', JSON.stringify(updates));
            },

            // Get deleted update IDs
            getDeletedUpdates: function() {
                const deleted = localStorage.getItem('deletedUpdates');
                return deleted ? JSON.parse(deleted) : [];
            },

            // Save deleted update IDs
            saveDeletedUpdates: function(deletedIds) {
                localStorage.setItem('deletedUpdates', JSON.stringify(deletedIds));
            },

            // Mark update as read
            markAsRead: function(updateId) {
                const updates = this.getUpdates();
                const updatedUpdates = updates.map(update => {
                    if (update.id === updateId) {
                        return { ...update, isRead: true };
                    }
                    return update;
                });
                this.saveUpdates(updatedUpdates);
                this.updateUnreadCount();
            },

            // Delete an update
            deleteUpdate: function(updateId) {
                const deletedIds = this.getDeletedUpdates();
                if (!deletedIds.includes(updateId)) {
                    deletedIds.push(updateId);
                    this.saveDeletedUpdates(deletedIds);
                    
                    // Hide the update immediately
                    const updateElement = document.querySelector(`[data-update-id="${updateId}"]`);
                    if (updateElement) {
                        updateElement.classList.add('deleted');
                    }
                    
                    this.checkEmptyState();
                }
            },

            // Load and render updates
            loadUpdates: function() {
                const updates = this.getUpdates();
                const deletedIds = this.getDeletedUpdates();
                const container = document.getElementById('updatesContainer');
                
                // Filter out deleted updates
                const visibleUpdates = updates.filter(update => !deletedIds.includes(update.id));
                
                if (visibleUpdates.length === 0) {
                    this.showEmptyState();
                    return;
                }
                
                // Render updates
                container.innerHTML = visibleUpdates.map(update => `
                    <div class="update ${update.isRead ? '' : 'unread'}" data-update-id="${update.id}">
                        <div class="update-content">
                            <div class="update-text">${update.content}</div>
                        </div>
                        <div class="update-meta">
                            <div class="update-reactions">
                                ${update.reactions.comments ? `<span>üí¨ ${update.reactions.comments}</span>` : ''}
                                ${update.reactions.likes ? `<span>üëç ${update.reactions.likes}</span>` : ''}
                            </div>
                            <div class="update-actions">
                                <button class="delete-update-btn" onclick="UpdatesManager.deleteUpdate(${update.id})">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                                <a href="#" class="view-whatsapp-btn">
                                    <i class="fab fa-whatsapp"></i> View update
                                </a>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                this.updateUnreadCount();
                this.hideEmptyState();
            },

            // Update unread count badge
            updateUnreadCount: function() {
                const updates = this.getUpdates();
                const deletedIds = this.getDeletedUpdates();
                const unreadUpdates = updates.filter(update => 
                    !update.isRead && !deletedIds.includes(update.id)
                );
                
                const unreadCount = unreadUpdates.length;
                const badge = document.getElementById('unreadBadge');
                const countElement = document.getElementById('unreadCount');
                
                if (unreadCount > 0) {
                    badge.style.display = 'inline-flex';
                    countElement.textContent = unreadCount;
                } else {
                    badge.style.display = 'none';
                }
            },

            // Show empty state
            showEmptyState: function() {
                document.getElementById('emptyUpdates').style.display = 'block';
                document.getElementById('updatesContainer').style.display = 'none';
            },

            // Hide empty state
            hideEmptyState: function() {
                document.getElementById('emptyUpdates').style.display = 'none';
                document.getElementById('updatesContainer').style.display = 'block';
            },

            // Check if updates container is empty
            checkEmptyState: function() {
                const updates = this.getUpdates();
                const deletedIds = this.getDeletedUpdates();
                const visibleUpdates = updates.filter(update => !deletedIds.includes(update.id));
                
                if (visibleUpdates.length === 0) {
                    this.showEmptyState();
                }
            },

            // Setup event listeners
            setupEventListeners: function() {
                // Scroll to bottom button
                document.getElementById('scrollToBottom').addEventListener('click', () => {
                    window.scrollTo({
                        top: document.body.scrollHeight,
                        behavior: 'smooth'
                    });
                });

                // Menu toggle
                const menuButton = document.querySelector('header button');
                const menu = document.getElementById('menu');
                
                if (menuButton && menu) {
                    menuButton.addEventListener('click', function() {
                        menu.hidden = !menu.hidden;
                    });
                }
                
                // Close menu when clicking outside
                document.addEventListener('click', function(event) {
                    if (menu && !menu.hidden && !menu.contains(event.target) && 
                        menuButton && !menuButton.contains(event.target)) {
                        menu.hidden = true;
                    }
                });

                // Set active nav link
                const currentPage = window.location.pathname.split('/').pop();
                const menuLinks = document.querySelectorAll('#menu a');
                
                menuLinks.forEach(link => {
                    if (link.getAttribute('href') === currentPage) {
                        link.classList.add('active');
                    }
                });
            },

            // Setup Intersection Observer for marking updates as read
            setupScrollObserver: function() {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const updateId = parseInt(entry.target.getAttribute('data-update-id'));
                            this.markAsRead(updateId);
                            entry.target.classList.remove('unread');
                        }
                    });
                }, {
                    threshold: 0.5
                });

                // Observe all update elements
                const updateElements = document.querySelectorAll('.update');
                updateElements.forEach(element => {
                    observer.observe(element);
                });
            },

            // Check for new updates (simulated - in real app, this would check a server)
            checkForNewUpdates: function() {
                // Simulate checking for new updates
                const lastUpdateCheck = localStorage.getItem('lastUpdateCheck');
                const now = Date.now();
                
                if (!lastUpdateCheck || (now - parseInt(lastUpdateCheck)) > 300000) { // 5 minutes
                    this.showNotificationBanner();
                }
                
                localStorage.setItem('lastUpdateCheck', now.toString());
            },

            // Show notification banner
            showNotificationBanner: function() {
                const banner = document.getElementById('notificationBanner');
                banner.style.display = 'flex';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    banner.style.display = 'none';
                }, 5000);
            },

            // Simulate global notifications (this would require a backend in production)
            setupGlobalNotifications: function() {
                // This is a simplified version - in production, you'd use a service worker
                // and push notifications for cross-device notifications
                
                if ('Notification' in window && Notification.permission === 'granted') {
                    // Check for new updates periodically
                    setInterval(() => {
                        this.checkForNewUpdates();
                    }, 300000); // Check every 5 minutes
                }
            }
        };

        // Request notification permission
        if ('Notification' in window) {
            Notification.requestPermission();
        }

        // Initialize updates manager when page loads
        document.addEventListener('DOMContentLoaded', function() {
            UpdatesManager.init();
        });

        function logout() {
            localStorage.removeItem('techUpdatesUser');
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>